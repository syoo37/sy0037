
## 크롤링


```python
# 동화약품 크롤링
start = datetime.datetime(2020, 1, 1)
end = datetime.datetime(2022, 3, 31)
df_null = wb.DataReader("000020.KS","yahoo",start,end)     # 000020.KS : 동화약품
df = df_null.dropna()                                  # 결측치 제거

# 새로운 칼럼 생성
# (Price : 당일 대비 다음날 주가가 상승했으면 1, 하락했으면 0 표시)
df['Price'] = 0
for i in range(0, 120):
    if df['Close'][i] < df['Close'][i+1]:
        df['Price'][i] = 1
    else:
        df['Price'][i] = 0
```

    C:\Users\cupid\AppData\Local\Temp\ipykernel_19280\749267265.py:14: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
      df['Price'][i] = 0
    C:\Users\cupid\AppData\Local\Temp\ipykernel_19280\749267265.py:12: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
      df['Price'][i] = 1
    


```python
df.to_csv('동화약품_주가데이터.csv')
df['등락률'] = (df['Open']-df['Adj Close'])/df['Adj Close']
df=df
#df[df['Price']==0]["Date"]
```


```python
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>High</th>
      <th>Low</th>
      <th>Open</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Adj Close</th>
      <th>Price</th>
      <th>등락률</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-02</th>
      <td>8400.0</td>
      <td>8290.0</td>
      <td>8340.0</td>
      <td>8400.0</td>
      <td>111305.0</td>
      <td>8215.657227</td>
      <td>0</td>
      <td>0.015135</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>8450.0</td>
      <td>8290.0</td>
      <td>8400.0</td>
      <td>8360.0</td>
      <td>96437.0</td>
      <td>8176.536133</td>
      <td>0</td>
      <td>0.027330</td>
    </tr>
    <tr>
      <th>2020-01-06</th>
      <td>8330.0</td>
      <td>8120.0</td>
      <td>8290.0</td>
      <td>8180.0</td>
      <td>73230.0</td>
      <td>8000.485840</td>
      <td>0</td>
      <td>0.036187</td>
    </tr>
    <tr>
      <th>2020-01-07</th>
      <td>8280.0</td>
      <td>8090.0</td>
      <td>8200.0</td>
      <td>8160.0</td>
      <td>117904.0</td>
      <td>7980.925293</td>
      <td>0</td>
      <td>0.027450</td>
    </tr>
    <tr>
      <th>2020-01-08</th>
      <td>8170.0</td>
      <td>7830.0</td>
      <td>8170.0</td>
      <td>7930.0</td>
      <td>263246.0</td>
      <td>7755.972656</td>
      <td>0</td>
      <td>0.053382</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-03-25</th>
      <td>13950.0</td>
      <td>13500.0</td>
      <td>13700.0</td>
      <td>13900.0</td>
      <td>248995.0</td>
      <td>13900.000000</td>
      <td>0</td>
      <td>-0.014388</td>
    </tr>
    <tr>
      <th>2022-03-28</th>
      <td>13900.0</td>
      <td>13600.0</td>
      <td>13900.0</td>
      <td>13750.0</td>
      <td>160036.0</td>
      <td>13750.000000</td>
      <td>0</td>
      <td>0.010909</td>
    </tr>
    <tr>
      <th>2022-03-29</th>
      <td>14000.0</td>
      <td>13650.0</td>
      <td>13850.0</td>
      <td>13750.0</td>
      <td>160334.0</td>
      <td>13750.000000</td>
      <td>0</td>
      <td>0.007273</td>
    </tr>
    <tr>
      <th>2022-03-30</th>
      <td>14200.0</td>
      <td>13750.0</td>
      <td>13800.0</td>
      <td>13900.0</td>
      <td>365447.0</td>
      <td>13900.000000</td>
      <td>0</td>
      <td>-0.007194</td>
    </tr>
    <tr>
      <th>2022-03-31</th>
      <td>13950.0</td>
      <td>13600.0</td>
      <td>13950.0</td>
      <td>13650.0</td>
      <td>214548.0</td>
      <td>13650.000000</td>
      <td>0</td>
      <td>0.021978</td>
    </tr>
  </tbody>
</table>
<p>554 rows × 8 columns</p>
</div>




```python
df[df["Price"]==0].index
```




    DatetimeIndex(['2020-01-02', '2020-01-03', '2020-01-06', '2020-01-07',
                   '2020-01-08', '2020-01-13', '2020-01-14', '2020-01-15',
                   '2020-01-20', '2020-01-28',
                   ...
                   '2022-03-18', '2022-03-21', '2022-03-22', '2022-03-23',
                   '2022-03-24', '2022-03-25', '2022-03-28', '2022-03-29',
                   '2022-03-30', '2022-03-31'],
                  dtype='datetime64[ns]', name='Date', length=492, freq=None)




```python
df_0 = df[df['Price']==0].index
date_0 = []
for i in range(0,len(df_0)):
    date_0.append(str(df_0.tolist()[i])[:10].replace('-',''))
    
date_0
```




    ['20200102',
     '20200103',
     '20200106',
     '20200107',
     '20200108',
     '20200113',
     '20200114',
     '20200115',
     '20200120',
     '20200128',
     '20200129',
     '20200130',
     '20200131',
     '20200206',
     '20200207',
     '20200211',
     '20200212',
     '20200214',
     '20200217',
     '20200219',
     '20200220',
     '20200221',
     '20200226',
     '20200227',
     '20200228',
     '20200306',
     '20200309',
     '20200310',
     '20200311',
     '20200312',
     '20200313',
     '20200316',
     '20200317',
     '20200318',
     '20200320',
     '20200408',
     '20200410',
     '20200423',
     '20200428',
     '20200429',
     '20200504',
     '20200506',
     '20200508',
     '20200512',
     '20200514',
     '20200518',
     '20200519',
     '20200520',
     '20200525',
     '20200527',
     '20200602',
     '20200603',
     '20200609',
     '20200610',
     '20200612',
     '20200616',
     '20200618',
     '20200625',
     '20200626',
     '20200629',
     '20200630',
     '20200701',
     '20200702',
     '20200703',
     '20200706',
     '20200707',
     '20200708',
     '20200709',
     '20200710',
     '20200713',
     '20200714',
     '20200715',
     '20200716',
     '20200717',
     '20200720',
     '20200721',
     '20200722',
     '20200723',
     '20200724',
     '20200727',
     '20200728',
     '20200729',
     '20200730',
     '20200731',
     '20200803',
     '20200804',
     '20200805',
     '20200806',
     '20200807',
     '20200810',
     '20200811',
     '20200812',
     '20200813',
     '20200814',
     '20200818',
     '20200819',
     '20200820',
     '20200821',
     '20200824',
     '20200825',
     '20200826',
     '20200827',
     '20200828',
     '20200831',
     '20200901',
     '20200902',
     '20200903',
     '20200904',
     '20200907',
     '20200908',
     '20200909',
     '20200910',
     '20200911',
     '20200914',
     '20200915',
     '20200916',
     '20200917',
     '20200918',
     '20200921',
     '20200922',
     '20200923',
     '20200924',
     '20200925',
     '20200928',
     '20200929',
     '20201005',
     '20201006',
     '20201007',
     '20201008',
     '20201012',
     '20201013',
     '20201014',
     '20201015',
     '20201016',
     '20201019',
     '20201020',
     '20201021',
     '20201022',
     '20201023',
     '20201026',
     '20201027',
     '20201028',
     '20201029',
     '20201030',
     '20201102',
     '20201103',
     '20201104',
     '20201105',
     '20201106',
     '20201109',
     '20201110',
     '20201111',
     '20201112',
     '20201113',
     '20201116',
     '20201117',
     '20201118',
     '20201119',
     '20201120',
     '20201123',
     '20201124',
     '20201125',
     '20201126',
     '20201127',
     '20201130',
     '20201201',
     '20201202',
     '20201203',
     '20201204',
     '20201207',
     '20201208',
     '20201209',
     '20201210',
     '20201211',
     '20201214',
     '20201215',
     '20201216',
     '20201217',
     '20201218',
     '20201221',
     '20201222',
     '20201223',
     '20201224',
     '20201228',
     '20201229',
     '20201230',
     '20210104',
     '20210105',
     '20210106',
     '20210107',
     '20210108',
     '20210111',
     '20210112',
     '20210113',
     '20210114',
     '20210115',
     '20210118',
     '20210119',
     '20210120',
     '20210121',
     '20210122',
     '20210125',
     '20210126',
     '20210127',
     '20210128',
     '20210129',
     '20210201',
     '20210202',
     '20210203',
     '20210204',
     '20210205',
     '20210208',
     '20210209',
     '20210210',
     '20210215',
     '20210216',
     '20210217',
     '20210218',
     '20210219',
     '20210222',
     '20210223',
     '20210224',
     '20210225',
     '20210226',
     '20210302',
     '20210303',
     '20210304',
     '20210305',
     '20210308',
     '20210309',
     '20210310',
     '20210311',
     '20210312',
     '20210315',
     '20210316',
     '20210317',
     '20210318',
     '20210319',
     '20210322',
     '20210323',
     '20210324',
     '20210325',
     '20210326',
     '20210329',
     '20210330',
     '20210331',
     '20210401',
     '20210402',
     '20210405',
     '20210406',
     '20210407',
     '20210408',
     '20210409',
     '20210412',
     '20210413',
     '20210414',
     '20210415',
     '20210416',
     '20210419',
     '20210420',
     '20210421',
     '20210422',
     '20210423',
     '20210426',
     '20210427',
     '20210428',
     '20210429',
     '20210430',
     '20210503',
     '20210504',
     '20210506',
     '20210507',
     '20210510',
     '20210511',
     '20210512',
     '20210513',
     '20210514',
     '20210517',
     '20210518',
     '20210520',
     '20210521',
     '20210524',
     '20210525',
     '20210526',
     '20210527',
     '20210528',
     '20210531',
     '20210601',
     '20210602',
     '20210603',
     '20210604',
     '20210607',
     '20210608',
     '20210609',
     '20210610',
     '20210611',
     '20210614',
     '20210615',
     '20210616',
     '20210617',
     '20210618',
     '20210621',
     '20210622',
     '20210623',
     '20210624',
     '20210625',
     '20210628',
     '20210629',
     '20210630',
     '20210701',
     '20210702',
     '20210705',
     '20210706',
     '20210707',
     '20210708',
     '20210709',
     '20210712',
     '20210713',
     '20210714',
     '20210715',
     '20210716',
     '20210719',
     '20210720',
     '20210721',
     '20210722',
     '20210723',
     '20210726',
     '20210727',
     '20210728',
     '20210729',
     '20210730',
     '20210802',
     '20210803',
     '20210804',
     '20210805',
     '20210806',
     '20210809',
     '20210810',
     '20210811',
     '20210812',
     '20210813',
     '20210817',
     '20210818',
     '20210819',
     '20210820',
     '20210823',
     '20210824',
     '20210825',
     '20210826',
     '20210827',
     '20210830',
     '20210831',
     '20210901',
     '20210902',
     '20210903',
     '20210906',
     '20210907',
     '20210908',
     '20210909',
     '20210910',
     '20210913',
     '20210914',
     '20210915',
     '20210916',
     '20210917',
     '20210923',
     '20210924',
     '20210927',
     '20210928',
     '20210929',
     '20210930',
     '20211001',
     '20211005',
     '20211006',
     '20211007',
     '20211008',
     '20211012',
     '20211013',
     '20211014',
     '20211015',
     '20211018',
     '20211019',
     '20211020',
     '20211021',
     '20211022',
     '20211025',
     '20211026',
     '20211027',
     '20211028',
     '20211029',
     '20211101',
     '20211102',
     '20211103',
     '20211104',
     '20211105',
     '20211108',
     '20211109',
     '20211110',
     '20211111',
     '20211112',
     '20211115',
     '20211116',
     '20211117',
     '20211118',
     '20211119',
     '20211122',
     '20211123',
     '20211124',
     '20211125',
     '20211126',
     '20211129',
     '20211130',
     '20211201',
     '20211202',
     '20211203',
     '20211206',
     '20211207',
     '20211208',
     '20211209',
     '20211210',
     '20211213',
     '20211214',
     '20211215',
     '20211216',
     '20211217',
     '20211220',
     '20211221',
     '20211222',
     '20211223',
     '20211224',
     '20211227',
     '20211228',
     '20211229',
     '20211230',
     '20220104',
     '20220105',
     '20220106',
     '20220107',
     '20220110',
     '20220111',
     '20220112',
     '20220113',
     '20220114',
     '20220117',
     '20220118',
     '20220119',
     '20220120',
     '20220121',
     '20220124',
     '20220125',
     '20220126',
     '20220127',
     '20220128',
     '20220203',
     '20220204',
     '20220207',
     '20220208',
     '20220209',
     '20220210',
     '20220211',
     '20220214',
     '20220215',
     '20220216',
     '20220217',
     '20220218',
     '20220221',
     '20220222',
     '20220223',
     '20220224',
     '20220225',
     '20220228',
     '20220302',
     '20220303',
     '20220304',
     '20220307',
     '20220308',
     '20220310',
     '20220311',
     '20220314',
     '20220315',
     '20220316',
     '20220317',
     '20220318',
     '20220321',
     '20220322',
     '20220323',
     '20220324',
     '20220325',
     '20220328',
     '20220329',
     '20220330',
     '20220331']




```python
df_1 = df[df['Price']==1].index

date_1 = []
for i in range(0,len(df_1)):
    date_1.append(str(df_1.tolist()[i])[:10].replace('-',''))
date_1
```




    ['20200109',
     '20200110',
     '20200116',
     '20200117',
     '20200121',
     '20200122',
     '20200123',
     '20200203',
     '20200204',
     '20200205',
     '20200210',
     '20200213',
     '20200218',
     '20200224',
     '20200225',
     '20200302',
     '20200303',
     '20200304',
     '20200305',
     '20200319',
     '20200323',
     '20200324',
     '20200325',
     '20200326',
     '20200327',
     '20200330',
     '20200331',
     '20200401',
     '20200402',
     '20200403',
     '20200406',
     '20200407',
     '20200409',
     '20200413',
     '20200414',
     '20200416',
     '20200417',
     '20200420',
     '20200421',
     '20200422',
     '20200424',
     '20200427',
     '20200507',
     '20200511',
     '20200513',
     '20200515',
     '20200521',
     '20200522',
     '20200526',
     '20200528',
     '20200529',
     '20200601',
     '20200604',
     '20200605',
     '20200608',
     '20200611',
     '20200615',
     '20200617',
     '20200619',
     '20200622',
     '20200623',
     '20200624']




```python
import requests
from bs4 import BeautifulSoup
import pandas as pd
from urllib import parse
from urllib.parse import quote
import openpyxl
```


```python
'''from IPython.core.display import display, HTML
display(HTML("<style>.container { width:95% !important; }</style>"))
display(HTML("<style>.input_area pre {font-family: Consolas; font-size: 20pt; line-height: 140%;}</style>"))
display(HTML("<style>.output_area pre {font-family: Consolas; font-size: 20pt; line-height: 140%;}</style>"))'''
```




    'from IPython.core.display import display, HTML\ndisplay(HTML("<style>.container { width:95% !important; }</style>"))\ndisplay(HTML("<style>.input_area pre {font-family: Consolas; font-size: 20pt; line-height: 140%;}</style>"))\ndisplay(HTML("<style>.output_area pre {font-family: Consolas; font-size: 20pt; line-height: 140%;}</style>"))'




```python
def news_crawling(keyword):
    global url
    print(f'검색: {keyword}')
    encoded_keyword=quote(keyword)
    url=f"http://www.paxnet.co.kr/search/news?kwd={encoded_keyword}&wlog_nsise=search&order=1"
    print(url)
    res=requests.get(url)
    soup= BeautifulSoup(res.text, 'lxml')
    
    result_list = []
    error_cnt = 0
    
    pass

   
news_crawling('동화약품')
print()
```

    검색: 동화약품
    http://www.paxnet.co.kr/search/news?kwd=%EB%8F%99%ED%99%94%EC%95%BD%ED%92%88&wlog_nsise=search&order=1
    
    


```python
result_list = []
error_cnt = 0

def paxnet_news_title(dates):
    global url
    
    base_url = url +'&currentPageNo={}&genDate={}'
        
    headers = {
        'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Safari/537.36'
    }
    
    for date in dates:
        for page in range(1, 3):
            url = base_url.format(page, date)
            res = requests.get(url, headers=headers)
            if res.status_code == 200:
                soup = BeautifulSoup(res.text)
                title_list = soup.select('ul.thumb-list li')
                for title in title_list:
                    try:
                        news_title = title.select_one('dl.text > dt').text.strip()
                        result_list.append([news_title])
                    except:
                        error_cnt += 1
```


```python
paxnet_news_title(date_0)
title_df_0 = pd.DataFrame(result_list, columns=['뉴스제목'])
title_df_0['주가변동'] = 0
result_list = []
error_cnt = 0

paxnet_news_title(date_1)
title_df_1 = pd.DataFrame(result_list, columns=['뉴스제목'])
title_df_1['주가변동'] = 1
title_df = pd.concat([title_df_0, title_df_1])
title_df.to_csv('팍스넷_뉴스타이틀.csv', index=False, encoding='utf-8')
title_df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>뉴스제목</th>
      <th>주가변동</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>기술적분석-코스피</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>증시요약(7) - 기술적 분석 특징주 A(코스피)</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>코스피 하락률 상위 20종목(직전 30분 기준)</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>오후장 기술적 분석 특징주 A(코스피)</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4795</th>
      <td>CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4796</th>
      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4797</th>
      <td>장마감 후 주요 종목 공시</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4798</th>
      <td>[e공시 눈에띄네] 코스피-20일</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4799</th>
      <td>[재송]20일 장 마감 후 주요 종목 뉴스</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>48050 rows × 2 columns</p>
</div>




```python
title_df = pd.read_csv('팍스넷_뉴스타이틀.csv', encoding='utf-8')
title_df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>뉴스제목</th>
      <th>주가변동</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>동화약품, 여드름 치료제 '세비타비겔' 출시</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>한국제약바이오협회, '디지털헬스위원회' 본격 가동</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>동화약품(000020)  소폭 상승세 +3.75%</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>한국제약바이오협회, 디지털헬스위원회 본격 가동…"디지털헬스케어 선도 역할"</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>55395</th>
      <td>CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주</td>
      <td>1</td>
    </tr>
    <tr>
      <th>55396</th>
      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>
      <td>1</td>
    </tr>
    <tr>
      <th>55397</th>
      <td>장마감 후 주요 종목 공시</td>
      <td>1</td>
    </tr>
    <tr>
      <th>55398</th>
      <td>[e공시 눈에띄네] 코스피-20일</td>
      <td>1</td>
    </tr>
    <tr>
      <th>55399</th>
      <td>[재송]20일 장 마감 후 주요 종목 뉴스</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>55400 rows × 2 columns</p>
</div>




```python
import scipy as sp
import pandas as pd
import numpy as np

from konlpy.tag import Kkma        ; kkma = Kkma()
from konlpy.tag import Hannanum    ; hannanum = Hannanum()
from konlpy.tag import Okt         ; t = Okt()     # 구 트위터
from konlpy.tag import *
import nltk
import pickle

from wordcloud import WordCloud, STOPWORDS
from PIL import Image

from sklearn.feature_extraction.text import CountVectorizer
from sklearn.feature_extraction.text import TfidfVectorizer 
from sklearn.linear_model import LogisticRegression
from sklearn.ensemble import RandomForestClassifier # 추가한 부분
from sklearn.pipeline import Pipeline 
from sklearn.metrics import accuracy_score
from sklearn.model_selection import train_test_split

%matplotlib inline
import os
import matplotlib.pyplot as plt
import seaborn as sns
import graphviz
from sklearn.tree import export_graphviz

import matplotlib.font_manager as fm
plt.rc('font', family='NanumGothic')

import matplotlib as mpl
mpl.rcParams['axes.unicode_minus'] = False

import warnings
warnings.filterwarnings('ignore')
```


```python
from wordcloud import WordCloud, STOPWORDS
from PIL import Image

import re
import pandas as pd
from tqdm import tqdm
from konlpy.tag import Okt
from collections import Counter
```


```python
def extract_word(text):
    hangul = re.compile('[^가-힣]') 
    result = hangul.sub(' ', text) 
    return result
```

#### 추가


```python
#title_df['뉴스제목'] = title_df['뉴스제목'].apply(lambda x:extract_word(x))
title_df['nouns'] = title_df['뉴스제목'].apply(lambda x:extract_word(x))
```


```python
vocab = {}
cnt = 0
for i in title_df['nouns']:
    i = i.split(' ')
    for j in range(len(i)):
        if i[j] in vocab or len(i[j])<=1:
            cnt =cnt+1
            pass
        else:
            vocab[i[j]] = 0

vocab
print(len(vocab), vocab) # 한글자짜리 빼고 저장
```

    107 {'동화약품': 0, '여드름': 0, '치료제': 0, '세비타비겔': 0, '출시': 0, '코스피': 0, '상승률': 0, '상위': 0, '종목': 0, '직전': 0, '기준': 0, '한국제약바이오협회': 0, '디지털헬스위원회': 0, '본격': 0, '가동': 0, '소폭': 0, '상승세': 0, '디지털헬스케어': 0, '선도': 0, '역할': 0, '기술적분석': 0, '증시요약': 0, '기술적': 0, '분석': 0, '특징주': 0, '코스닥': 0, '후시드': 0, '크림': 0, '개월': 0, '만에': 0, '누적': 0, '판매액': 0, '억원': 0, '돌파': 0, '판매고': 0, '달성': 0, '외국계': 0, '매수': 0, '유입': 0, '하락률': 0, '순식간에': 0, '등장한': 0, '모더나': 0, '백신': 0, '끈질긴': 0, '투자': 0, '결과물': 0, '서울국제신약포럼': 0, '오후장': 0, '오전장': 0, '비타민': 0, '소화제': 0, '파스': 0, '약값도': 0, '줄줄이': 0, '오른다': 0, '개장전': 0, '주요이슈': 0, '점검': 0, '메디케어': 0, '의료용': 0, '밴드': 0, '창상피복재': 0, '공동개발': 0, '업무협력': 0, '부음': 0, '임재준': 0, '한국거래소': 0, '유가증권시장본부': 0, '부이사장': 0, '모친상': 0, '부고': 0, '임재준씨': 0, '타이레놀': 0, '매출': 0, '강세': 0, '지속': 0, '일반의약품': 0, '증대': 0, '동화': 0, '바르지오': 0, '원스': 0, '여름철': 0, '손발톱': 0, '무좀': 0, '고민': 0, '대한통운': 0, '건설부문': 0, '사옥': 0, '신축공사': 0, '수주': 0, '순화동': 0, '철거': 0, '규모': 0, '재건축': 0, '역사': 0, '지상': 0, '신사옥': 0, '착공': 0, '서울': 0, '장마감': 0, '주요': 0, '공시': 0, '눈에띄네': 0, '재송': 0, '마감': 0, '뉴스': 0}
    


```python
up = 6200
down = 49200
up_ratio = up/(up+down)
down_ratio = down/(up+down)

import collections
for i,w in enumerate(title_df['nouns']):
    w = w.split(' ')
    if (title_df.iloc[i]['주가변동']==1):
        for j in range(len(w)):
            noun = w[j]
            if len(noun)<=1:
                continue
            vocab[noun] = vocab[noun] + down_ratio
    else:
        for j in range(len(w)):
            noun = w[j]
            if len(noun)<=1:
                continue
            vocab[noun] = vocab[noun] - up_ratio
            
vocab
```




    {'동화약품': 2.6260704721892125e-10,
     '여드름': -1.4732659536775827e-12,
     '치료제': -1.4732659536775827e-12,
     '세비타비겔': -1.4732659536775827e-12,
     '출시': 2.6620927684462004e-12,
     '코스피': 8.083038682826782e-10,
     '상승률': 1.7165757704162843e-10,
     '상위': 3.990312524848605e-10,
     '종목': 4.899807226621533e-10,
     '직전': 1.2618284195298202e-10,
     '기준': 1.2618284195298202e-10,
     '한국제약바이오협회': 9.938050382629626e-12,
     '디지털헬스위원회': 9.938050382629626e-12,
     '본격': 9.938050382629626e-12,
     '가동': 9.938050382629626e-12,
     '소폭': 2.6620927684462004e-12,
     '상승세': 2.6620927684462004e-12,
     '디지털헬스케어': -1.4732659536775827e-12,
     '선도': -1.4732659536775827e-12,
     '역할': -1.4732659536775827e-12,
     '기술적분석': 3.523337177568919e-11,
     '증시요약': 2.6620927684462004e-12,
     '기술적': 3.523337177568919e-11,
     '분석': 3.523337177568919e-11,
     '특징주': 3.523337177568919e-11,
     '코스닥': -1.4845680240682668e-11,
     '후시드': 9.938050382629626e-12,
     '크림': 9.938050382629626e-12,
     '개월': 9.938050382629626e-12,
     '만에': -1.4732659536775827e-12,
     '누적': -1.4732659536775827e-12,
     '판매액': -1.4732659536775827e-12,
     '억원': -1.4732659536775827e-12,
     '돌파': -1.4732659536775827e-12,
     '판매고': -1.4732659536775827e-12,
     '달성': -1.4732659536775827e-12,
     '외국계': -1.4732659536775827e-12,
     '매수': -1.4732659536775827e-12,
     '유입': -1.4732659536775827e-12,
     '하락률': -1.0241363312957219e-11,
     '순식간에': -1.4732659536775827e-12,
     '등장한': -1.4732659536775827e-12,
     '모더나': -1.4732659536775827e-12,
     '백신': -1.4732659536775827e-12,
     '끈질긴': -1.4732659536775827e-12,
     '투자': -1.4732659536775827e-12,
     '결과물': -1.4732659536775827e-12,
     '서울국제신약포럼': -1.4732659536775827e-12,
     '오후장': -1.4732659536775827e-12,
     '오전장': 9.938050382629626e-12,
     '비타민': -1.4732659536775827e-12,
     '소화제': -1.4732659536775827e-12,
     '파스': -1.4732659536775827e-12,
     '약값도': -1.4732659536775827e-12,
     '줄줄이': -1.4732659536775827e-12,
     '오른다': -1.4732659536775827e-12,
     '개장전': -1.4732659536775827e-12,
     '주요이슈': -1.4732659536775827e-12,
     '점검': -1.4732659536775827e-12,
     '메디케어': -1.4732659536775827e-12,
     '의료용': -1.4732659536775827e-12,
     '밴드': -1.4732659536775827e-12,
     '창상피복재': -1.4732659536775827e-12,
     '공동개발': -1.4732659536775827e-12,
     '업무협력': -1.4732659536775827e-12,
     '부음': -1.4732659536775827e-12,
     '임재준': 9.938050382629626e-12,
     '한국거래소': 2.6620927684462004e-12,
     '유가증권시장본부': 2.6620927684462004e-12,
     '부이사장': 2.6620927684462004e-12,
     '모친상': 2.6620927684462004e-12,
     '부고': -1.4732659536775827e-12,
     '임재준씨': -1.4732659536775827e-12,
     '타이레놀': -1.4732659536775827e-12,
     '매출': 9.938050382629626e-12,
     '강세': -1.4732659536775827e-12,
     '지속': -1.4732659536775827e-12,
     '일반의약품': -1.4732659536775827e-12,
     '증대': -1.4732659536775827e-12,
     '동화': -1.4732659536775827e-12,
     '바르지오': -1.4732659536775827e-12,
     '원스': -1.4732659536775827e-12,
     '여름철': -1.4732659536775827e-12,
     '손발톱': -1.4732659536775827e-12,
     '무좀': -1.4732659536775827e-12,
     '고민': -1.4732659536775827e-12,
     '대한통운': 9.938050382629626e-12,
     '건설부문': 9.938050382629626e-12,
     '사옥': 2.6620927684462004e-12,
     '신축공사': 9.938050382629626e-12,
     '수주': 9.938050382629626e-12,
     '순화동': 2.6620927684462004e-12,
     '철거': -1.4732659536775827e-12,
     '규모': -1.4732659536775827e-12,
     '재건축': -1.4732659536775827e-12,
     '역사': -1.4732659536775827e-12,
     '지상': -1.4732659536775827e-12,
     '신사옥': -1.4732659536775827e-12,
     '착공': -1.4732659536775827e-12,
     '서울': -1.4732659536775827e-12,
     '장마감': -1.4732659536775827e-12,
     '주요': 9.938050382629626e-12,
     '공시': 9.938050382629626e-12,
     '눈에띄네': -1.4732659536775827e-12,
     '재송': -1.4732659536775827e-12,
     '마감': -1.4732659536775827e-12,
     '뉴스': -1.4732659536775827e-12}




```python
total = []
for i,w  in enumerate(title_df['nouns']):
    sent_score = 0
    w= w.split(' ')
    for j in w:
        if(len(j)<=1):
            continue
        elif(j not in vocab):
            continue
        else:
            sent_score = sent_score + vocab[j]
    total.append(sent_score/len(w))
title_df['sent_score'] = total
title_df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>뉴스제목</th>
      <th>주가변동</th>
      <th>nouns</th>
      <th>sent_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>동화약품, 여드름 치료제 '세비타비겔' 출시</td>
      <td>0</td>
      <td>동화약품  여드름 치료제  세비타비겔  출시</td>
      <td>3.260617e-11</td>
    </tr>
    <tr>
      <th>1</th>
      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>
      <td>0</td>
      <td>코스피 상승률 상위   종목 직전   분 기준</td>
      <td>1.767783e-10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>한국제약바이오협회, '디지털헬스위원회' 본격 가동</td>
      <td>0</td>
      <td>한국제약바이오협회   디지털헬스위원회  본격 가동</td>
      <td>5.678886e-12</td>
    </tr>
    <tr>
      <th>3</th>
      <td>동화약품(000020)  소폭 상승세 +3.75%</td>
      <td>0</td>
      <td>동화약품          소폭 상승세</td>
      <td>1.410164e-11</td>
    </tr>
    <tr>
      <th>4</th>
      <td>한국제약바이오협회, 디지털헬스위원회 본격 가동…"디지털헬스케어 선도 역할"</td>
      <td>0</td>
      <td>한국제약바이오협회  디지털헬스위원회 본격 가동  디지털헬스케어 선도 역할</td>
      <td>3.533240e-12</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>55395</th>
      <td>CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주</td>
      <td>1</td>
      <td>대한통운 건설부문  서울 순화동 동화약품 사옥 신축공사 수주</td>
      <td>2.783729e-11</td>
    </tr>
    <tr>
      <th>55396</th>
      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>
      <td>1</td>
      <td>코스피 상승률 상위   종목 직전   분 기준</td>
      <td>1.767783e-10</td>
    </tr>
    <tr>
      <th>55397</th>
      <td>장마감 후 주요 종목 공시</td>
      <td>1</td>
      <td>장마감 후 주요 종목 공시</td>
      <td>1.016767e-10</td>
    </tr>
    <tr>
      <th>55398</th>
      <td>[e공시 눈에띄네] 코스피-20일</td>
      <td>1</td>
      <td>공시 눈에띄네  코스피   일</td>
      <td>9.075207e-11</td>
    </tr>
    <tr>
      <th>55399</th>
      <td>[재송]20일 장 마감 후 주요 종목 뉴스</td>
      <td>1</td>
      <td>재송   일 장 마감 후 주요 종목 뉴스</td>
      <td>4.504536e-11</td>
    </tr>
  </tbody>
</table>
<p>55400 rows × 4 columns</p>
</div>




```python
import operator 
sorted(vocab.items(), key=operator.itemgetter(1), reverse=True)[52] # 중간값
```




    ('유입', -1.4732659536775827e-12)




```python
print(len(vocab)/2) # 중간
print(sent_mean) # 평균
```

    53.5
    2.4161123776652177e-11
    


```python
sum = 0
for i in range(len(vocab)):
    sum = sum + list(vocab.values())[i]
sent_mean = sum/len(vocab)

a_ = []
for i in range(len(title_df)):
    if(title_df.iloc[i]['sent_score']>sent_mean):
        a_.append(1)
    else:
        a_.append(0)
title_df['sent_label'] = a_
title_df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>뉴스제목</th>
      <th>주가변동</th>
      <th>nouns</th>
      <th>sent_score</th>
      <th>sent_label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>동화약품, 여드름 치료제 '세비타비겔' 출시</td>
      <td>0</td>
      <td>동화약품  여드름 치료제  세비타비겔  출시</td>
      <td>3.260617e-11</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>
      <td>0</td>
      <td>코스피 상승률 상위   종목 직전   분 기준</td>
      <td>1.767783e-10</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>한국제약바이오협회, '디지털헬스위원회' 본격 가동</td>
      <td>0</td>
      <td>한국제약바이오협회   디지털헬스위원회  본격 가동</td>
      <td>5.678886e-12</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>동화약품(000020)  소폭 상승세 +3.75%</td>
      <td>0</td>
      <td>동화약품          소폭 상승세</td>
      <td>1.410164e-11</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>한국제약바이오협회, 디지털헬스위원회 본격 가동…"디지털헬스케어 선도 역할"</td>
      <td>0</td>
      <td>한국제약바이오협회  디지털헬스위원회 본격 가동  디지털헬스케어 선도 역할</td>
      <td>3.533240e-12</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>55395</th>
      <td>CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주</td>
      <td>1</td>
      <td>대한통운 건설부문  서울 순화동 동화약품 사옥 신축공사 수주</td>
      <td>2.783729e-11</td>
      <td>1</td>
    </tr>
    <tr>
      <th>55396</th>
      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>
      <td>1</td>
      <td>코스피 상승률 상위   종목 직전   분 기준</td>
      <td>1.767783e-10</td>
      <td>1</td>
    </tr>
    <tr>
      <th>55397</th>
      <td>장마감 후 주요 종목 공시</td>
      <td>1</td>
      <td>장마감 후 주요 종목 공시</td>
      <td>1.016767e-10</td>
      <td>1</td>
    </tr>
    <tr>
      <th>55398</th>
      <td>[e공시 눈에띄네] 코스피-20일</td>
      <td>1</td>
      <td>공시 눈에띄네  코스피   일</td>
      <td>9.075207e-11</td>
      <td>1</td>
    </tr>
    <tr>
      <th>55399</th>
      <td>[재송]20일 장 마감 후 주요 종목 뉴스</td>
      <td>1</td>
      <td>재송   일 장 마감 후 주요 종목 뉴스</td>
      <td>4.504536e-11</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>55400 rows × 5 columns</p>
</div>




```python
title_df.dropna(how='any',inplace= True)
title_df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>뉴스제목</th>
      <th>주가변동</th>
      <th>nouns</th>
      <th>sent_score</th>
      <th>sent_label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>동화약품, 여드름 치료제 '세비타비겔' 출시</td>
      <td>0</td>
      <td>동화약품  여드름 치료제  세비타비겔  출시</td>
      <td>3.260617e-11</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>
      <td>0</td>
      <td>코스피 상승률 상위   종목 직전   분 기준</td>
      <td>1.767783e-10</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>한국제약바이오협회, '디지털헬스위원회' 본격 가동</td>
      <td>0</td>
      <td>한국제약바이오협회   디지털헬스위원회  본격 가동</td>
      <td>5.678886e-12</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>동화약품(000020)  소폭 상승세 +3.75%</td>
      <td>0</td>
      <td>동화약품          소폭 상승세</td>
      <td>1.410164e-11</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>한국제약바이오협회, 디지털헬스위원회 본격 가동…"디지털헬스케어 선도 역할"</td>
      <td>0</td>
      <td>한국제약바이오협회  디지털헬스위원회 본격 가동  디지털헬스케어 선도 역할</td>
      <td>3.533240e-12</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>55395</th>
      <td>CJ대한통운 건설부문, 서울 순화동 동화약품 사옥 신축공사 수주</td>
      <td>1</td>
      <td>대한통운 건설부문  서울 순화동 동화약품 사옥 신축공사 수주</td>
      <td>2.783729e-11</td>
      <td>1</td>
    </tr>
    <tr>
      <th>55396</th>
      <td>코스피 상승률 상위 20종목(직전 30분 기준)</td>
      <td>1</td>
      <td>코스피 상승률 상위   종목 직전   분 기준</td>
      <td>1.767783e-10</td>
      <td>1</td>
    </tr>
    <tr>
      <th>55397</th>
      <td>장마감 후 주요 종목 공시</td>
      <td>1</td>
      <td>장마감 후 주요 종목 공시</td>
      <td>1.016767e-10</td>
      <td>1</td>
    </tr>
    <tr>
      <th>55398</th>
      <td>[e공시 눈에띄네] 코스피-20일</td>
      <td>1</td>
      <td>공시 눈에띄네  코스피   일</td>
      <td>9.075207e-11</td>
      <td>1</td>
    </tr>
    <tr>
      <th>55399</th>
      <td>[재송]20일 장 마감 후 주요 종목 뉴스</td>
      <td>1</td>
      <td>재송   일 장 마감 후 주요 종목 뉴스</td>
      <td>4.504536e-11</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>55400 rows × 5 columns</p>
</div>




```python
title_df['sent_label'].value_counts()
```




    1    32132
    0    23268
    Name: sent_label, dtype: int64

